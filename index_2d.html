<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>axe19测试</title>
        <style>
            canvas {
                outline: 1px dashed lightskyblue;
                position: fixed;
                top: 40px;
            }
        </style>
        <!-- 引入所有用到的文件 -->
        <script src='utils.js'></script>
        <script src='gua_object.js'></script>
        <script src='vector.js'></script>
        <script src='color.js'></script>
        <script src='vertex.js'></script>
        <script src='matrix.js'></script>
        <script src='texture.js'></script>
        <script src='mesh.js'></script>
        <script src='canvas.js'></script>
    </head>
    <body>
        <canvas id="id-canvas" width="400" height="300"></canvas>
<script>

const __main = function() {
        let canvas = GuaCanvas.new('#id-canvas')
/*
        // part 1
        let v1 = GuaVertex.new(GuaVector.new(150, 10), GuaColor.red())
        let v2 = GuaVertex.new(GuaVector.new(10, 100), GuaColor.blue())
        let v3 = GuaVertex.new(GuaVector.new(300, 200), GuaColor.green())
        canvas.drawScanline(v1, v2)
        canvas.drawTriangle(v1, v2, v3)

        let mesh = GuaMesh.cube()
        canvas.drawMesh(mesh)
*/

        const cb = function(guaImage) {
            const texture = GuaTexture.new(guaImage)
            canvas.drawTexture(texture)
            canvas.render()
        }
        // loadTexture('http://localhost:90/axe19/ss.guaimage', cb)
        loadTexture('http://localhost:90/axe19/bmp24_doge.guaimage', cb)

/*
        setInterval(function() {
            canvas.clear()
            // mesh.rotation.x += 0.1
            mesh.rotation.y += 0.1
            canvas.drawMesh(mesh)
            canvas.render()
        }, 200)
        let tm = new TestMatrix()
        tm.test()
*/

}

const loadTexture = function(imageUrl, cb) {
    ajaxGet(imageUrl, (guaImage) => {
        cb && cb(guaImage)
    })
}

const ajaxGet = function(url, callback) {
    let r = new XMLHttpRequest()
    r.open('GET', url, true)
    r.onreadystatechange = function() {
        if (r.readyState === 4) {
            callback(r.response)
        }
    }
    r.send()
}

__main()
</script>
    </body>
</html>
